---
title: "–ó–∞–º–µ—Ç–∫–∏ Kafka vs Rabbitmq"
date: 2025-05-06T09:42:43+05:00
description:
author: "Konstantin Shibkov"
tags: ["dev", "kafka", "rabbitmq"]
categories: ["–†–∞–∑—Ä–∞–±–æ—Ç–∫–∞"]
draft: true
---
# –û–±—â–∏–µ –ø–æ–Ω—è—Ç–∏—è –∏ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ Kafka –∏ RabbitMQ
–û—á–µ—Ä–µ–¥—å —Å–æ–æ–±—â–µ–Ω–∏–π ‚Äî –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã, –≥–¥–µ –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—å (producer) –∏ –ø–æ–ª—É—á–∞—Ç–µ–ª—å (consumer) –Ω–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤—É—é—Ç –Ω–∞–ø—Ä—è–º—É—é.

–ü–æ–∑–≤–æ–ª—è–µ—Ç –±—É—Ñ–µ—Ä–∏–∑–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ, –ø–æ–≤—ã—Å–∏—Ç—å –æ—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å, –æ–±–µ—Å–ø–µ—á–∏—Ç—å –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ decoupling –º–µ–∂–¥—É —Å–µ—Ä–≤–∏—Å–∞–º–∏.

## Kafka –∏ RabbitMQ ‚Äî –æ–±—â–∏–µ —á–µ—Ä—Ç—ã

| –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞      | Kafka                                                                                                                                                                                                                            | RabbitMQ                                                                                                                                                                                          |
| ------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| –ü–æ–¥—Ö–æ–¥              | Log-based, pub/sub                                                                                                                                                                                                               | Classic message queue (AMQP)                                                                                                                                                                      |
| –î–æ—Å—Ç–∞–≤–∫–∞            | Pull ‚Äî –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–∏ _—á–∏—Ç–∞—é—Ç_ –∏–∑ –∂—É—Ä–Ω–∞–ª–∞ —Å–∞–º–∏.                                                                                                                                                                                     | Push ‚Äî —Å–æ–æ–±—â–µ–Ω–∏—è _–æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è_ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—è–º.                                                                                                                                                     |
| –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞         | –°–æ–æ–±—â–µ–Ω–∏—è —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ —Ç–æ–ø–∏–∫–µ, –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–∏ –º–æ–≥—É—Ç —á–∏—Ç–∞—Ç—å –∏—Ö –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ.                                                                                                                                                          | –ë—Ä–æ–∫–µ—Ä –ø–æ–ª—É—á–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –∏ –¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –∏—Ö –æ–¥–Ω–æ–º—É –∏–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–∏–º –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—è–º.                                                                                                                     |
| –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ          | –î–ª–∏—Ç–µ–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ (log)                                                                                                                                                                                                        | –î–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è/TTL/DLQ                                                                                                                                                                          |
| –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ—Å—Ç—å    | –ò–∑ –∫–æ—Ä–æ–±–∫–∏ (–±—Ä–æ–∫–µ—Ä—ã, ZooKeeper/KRaft)                                                                                                                                                                                            | –ú–µ–Ω–µ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º –±–µ–∑ –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏–∏                                                                                                                                                              |
| –ü–æ–≤—Ç–æ—Ä–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ | –î–∞, –≤–æ–∑–º–æ–∂–µ–Ω –ø–æ–≤—Ç–æ—Ä–Ω—ã–π pull                                                                                                                                                                                                      | –ó–∞–≤–∏—Å–∏—Ç –æ—Ç ack/nack –∏ DLQ                                                                                                                                                                         |
| –ò–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å         | –¢—Ä–µ–±—É–µ—Ç —Ä—É—á–Ω–æ–≥–æ –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è                                                                                                                                                                                                      | –¢—Ä–µ–±—É–µ—Ç —Ä—É—á–Ω–æ–≥–æ –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è                                                                                                                                                                       |
| Use-case            | –í—ã—Å–æ–∫–æ–Ω–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö —Å–∏—Å—Ç–µ–º, —Å—Ç—Ä–∏–º–∏–Ω–≥–∞ —Å–æ–±—ã—Ç–∏–π, –∞–Ω–∞–ª–∏—Ç–∏–∫–∏, –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ–≥–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è.<br><br>- –í—ã—Å–æ–∫–∞—è –ø—Ä–æ–ø—É—Å–∫–Ω–∞—è —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å<br><br>- –ò—Å—Ç–æ—Ä–∏—á–Ω–æ—Å—Ç—å —Å–æ–±—ã—Ç–∏–π (event sourcing)<br><br>- Data pipeline (ETL, –∞–Ω–∞–ª–∏—Ç–∏–∫–∞, clickstream) | –ö–ª–∞—Å—Å–∏—á–µ—Å–∫–æ–π –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–¥–∞—á, –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–æ–≤, –≥–¥–µ –≤–∞–∂–Ω–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –¥–æ—Å—Ç–∞–≤–∫–∏ (ack).<br><br>- Webhooks, RPC<br>    <br>- –û—Ç–ø—Ä–∞–≤–∫–∞ email/SMS<br>    <br>- Task-–æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã |
| –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç—å         | –°–æ–æ–±—â–µ–Ω–∏—è –æ—Å—Ç–∞—é—Ç—Å—è –≤ Kafka –¥–æ–ª–≥–æ, –∏ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–∏ –º–æ–≥—É—Ç –∏—Ö –ø–µ—Ä–µ—á–∏—Ç—ã–≤–∞—Ç—å.                                                                                                                                                           | –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Å–ª–æ–∂–Ω—ã–µ –º–∞—Ä—à—Ä—É—Ç—ã —á–µ—Ä–µ–∑ Exchange/Binding.                                                                                                                                             |
–ü—Ä–µ–¥—Å—Ç–∞–≤—å –º–∞–≥–∞–∑–∏–Ω:

- **RabbitMQ** –±—É–¥–µ—Ç –∫–∞–∫ –∫—É—Ä—å–µ—Ä ‚Äî –¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –∫–∞–∂–¥—ã–π –∑–∞–∫–∞–∑ (—Å–æ–æ–±—â–µ–Ω–∏–µ) –Ω—É–∂–Ω–æ–º—É –æ—Ç–¥–µ–ª—É (–ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—é) –∏ —É–±–µ–∂–¥–∞–µ—Ç—Å—è, —á—Ç–æ –µ–≥–æ –ø—Ä–∏–Ω—è–ª–∏.

- **Kafka** ‚Äî —ç—Ç–æ –∫–∞–∫ –æ–≥—Ä–æ–º–Ω–∞—è –ª–µ–Ω—Ç–∞ –∑–∞–∫–∞–∑–æ–≤, –∫ –∫–æ—Ç–æ—Ä–æ–π —Ä–∞–∑–Ω—ã–µ –æ—Ç–¥–µ–ª—ã –º–æ–≥—É—Ç –ø–æ–¥–∫–ª—é—á–∞—Ç—å—Å—è, —á–∏—Ç–∞—Ç—å —Å—Ç–∞—Ä—ã–µ –∑–∞–∫–∞–∑—ã –∏ –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø–æ–≤–µ–¥–µ–Ω–∏–µ –ø–æ–∫—É–ø–∞—Ç–µ–ª–µ–π.

# –£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –∏ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ RabbitMQ

## –û—Å–Ω–æ–≤–Ω—ã–µ –ø–æ–Ω—è—Ç–∏—è
- **Producer** ‚Äî –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—å —Å–æ–æ–±—â–µ–Ω–∏–π. –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ **–≤ Exchange**, –∞ –Ω–µ –ø—Ä—è–º–æ –≤ –æ—á–µ—Ä–µ–¥—å. (‚õî –ü—Ä—è–º–æ–π –ø—É—Ç—å –≤ –æ—á–µ—Ä–µ–¥—å –Ω–µ–≤–æ–∑–º–æ–∂–µ–Ω –±–µ–∑ —É—á–∞—Å—Ç–∏—è Exchange.)
- **Exchange** (–æ–±–º–µ–Ω–Ω–∏–∫) ‚Äî –ø–æ–ª—É—á–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –∏ **–Ω–∞ –æ—Å–Ω–æ–≤–∞–Ω–∏–∏ —Ç–∏–ø–∞ –∏ –ø—Ä–∞–≤–∏–ª (Binding)** —Ä–µ—à–∞–µ—Ç, –≤ –∫–∞–∫—É—é **–æ—á–µ—Ä–µ–¥—å –∏–ª–∏ –æ—á–µ—Ä–µ–¥–∏** –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —ç—Ç–æ —Å–æ–æ–±—â–µ–Ω–∏–µ.
- **Queue** ‚Äî —Ö—Ä–∞–Ω–∏–ª–∏—â–µ —Å–æ–æ–±—â–µ–Ω–∏–π, –∏–∑ –∫–æ—Ç–æ—Ä–æ–≥–æ —á–∏—Ç–∞—é—Ç –∫–æ–Ω—Å—å—é–º–µ—Ä—ã. –ú–µ—Å—Ç–æ, –≥–¥–µ **–±—É—Ñ–µ—Ä–∏–∑—É—é—Ç—Å—è** —Å–æ–æ–±—â–µ–Ω–∏—è. –û–¥–∏–Ω –∏–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ **Consumers (–ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–µ–π)** –º–æ–≥—É—Ç —á–∏—Ç–∞—Ç—å –∏–∑ –Ω–µ—ë.
- **Binding** ‚Äî —ç—Ç–æ –∫–∞–∫ **–º–∞—Ä—à—Ä—É—Ç–Ω–æ–µ –ø—Ä–∞–≤–∏–ª–æ**, —Å–≤—è–∑—ã–≤–∞—é—â–µ–µ Exchange —Å –æ—á–µ—Ä–µ–¥—å—é. –í –Ω—ë–º —É–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è, **–ø—Ä–∏ –∫–∞–∫–∏—Ö —É—Å–ª–æ–≤–∏—è—Ö —Å–æ–æ–±—â–µ–Ω–∏–µ –∏–∑ Exchange –ø–æ–ø–∞–¥—ë—Ç –≤ –æ—á–µ—Ä–µ–¥—å.**
- **Routing Key** - —ç—Ç–æ —Å—Ç—Ä–æ–∫–∞, –∫–æ—Ç–æ—Ä–∞—è –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è Exchange'–æ–º –¥–ª—è –ø—Ä–∏–Ω—è—Ç–∏—è —Ä–µ—à–µ–Ω–∏—è, –≤ –∫–∞–∫—É—é –æ—á–µ—Ä–µ–¥—å (–∏–ª–∏ –æ—á–µ—Ä–µ–¥–∏) –Ω–∞–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ. –û–Ω–∞ –∑–∞–¥–∞—ë—Ç—Å—è –ø—Ä–æ–¥—é—Å–µ—Ä–æ–º –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ —Å–æ–æ–±—â–µ–Ω–∏—è –∏ –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è Exchange'–æ–º –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –µ–≥–æ —Ç–∏–ø–∞.

### –ü—Ä–æ—Å—Ç–æ–π –∞–Ω–∞–ª–æ–≥: üì¶üì¨

- Producer ‚Äî –∫–∞–∫ —á–µ–ª–æ–≤–µ–∫, –æ—Ç–ø—Ä–∞–≤–ª—è—é—â–∏–π –ø–æ—Å—ã–ª–∫—É –Ω–∞ –ø–æ—á—Ç–µ.
- Exchange ‚Äî –∫–∞–∫ –ø–æ—á—Ç–æ–≤—ã–π —Å–æ—Ä—Ç–∏—Ä–æ–≤–æ—á–Ω—ã–π —Ü–µ–Ω—Ç—Ä.
- Binding ‚Äî –∫–∞–∫ –º–∞—Ä—à—Ä—É—Ç–Ω–∞—è –Ω–∞–∫–ª–µ–π–∫–∞: "–≤ –∫–∞–∫–æ–π –≥–æ—Ä–æ–¥/–æ—Ç–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å".
- Queue ‚Äî –∫–∞–∫ –æ—Ç–¥–µ–ª–µ–Ω–∏–µ –ø–æ—á—Ç—ã, –≥–¥–µ —Ö—Ä–∞–Ω—è—Ç—Å—è –ø–æ—Å—ã–ª–∫–∏ –¥–æ –ø–æ–ª—É—á–µ–Ω–∏—è.
- Consumer ‚Äî –∫–∞–∫ —á–µ–ª–æ–≤–µ–∫, –ø—Ä–∏—à–µ–¥—à–∏–π –∑–∞–±–∏—Ä–∞—Ç—å –ø–æ—Å—ã–ª–∫—É.

## –¢–∏–ø—ã –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏ Exchange
| –¢–∏–ø     | –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è routing key                                                                                                                                                                                |
| ------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| Direct  | –î–æ–ª–∂–µ–Ω —Ç–æ—á–Ω–æ —Å–æ–≤–ø–∞–¥–∞—Ç—å —Å –∫–ª—é—á–æ–º –≤ binding'–µ –æ—á–µ—Ä–µ–¥–∏                                                                                                                                                         |
| Topic   | –ò—Å–ø–æ–ª—å–∑—É–µ—Ç —à–∞–±–ª–æ–Ω—ã (`*`, `#`) –¥–ª—è —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, `user.*`, `*.order`)                                                                                                                             |
| Fanout  | –ò–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç—Å—è. –°–æ–æ–±—â–µ–∏–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –≤—Å–µ–º –æ—á–µ—Ä–µ–¥—è–º, —Å–≤—è–∑–∞–Ω–Ω—ã–º —Å exchange, –±–µ–∑ —É—Å–ª–æ–≤–∏–π                                                                                                                        |
| Headers | –ù–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è. –ü–æ –∑–∞–≥–æ–ª–æ–≤–∫–∞–º —Å–æ–æ–±—â–µ–Ω–∏—è, –Ω–µ –ø–æ –∫–ª—é—á—É. –•–æ—Ä–æ—à–æ –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è —Å–ª–æ–∂–Ω–æ–π –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏, –æ—Å–Ω–æ–≤–∞–Ω–Ω–æ–π –Ω–∞ –º–µ—Ç–∞-–∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏. –ß–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –ø–æ —Ç–∏–ø—É –¥–æ–∫—É–º–µ–Ω—Ç–∞, —Ä–µ–≥–∏–æ–Ω—É, —è–∑—ã–∫—É –∏ —Ç.–¥. |

üëâ Routing key –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è –≤ –º–æ–º–µ–Ω—Ç Binding ‚Äî –ø—Ä–∏ —Å–≤—è–∑–∏ –æ—á–µ—Ä–µ–¥–∏ –∏ –æ–±–º–µ–Ω–Ω–∏–∫–∞. –ú–æ–∂–Ω–æ —Å–∫–∞–∑–∞—Ç—å, —á—Ç–æ **–æ—á–µ—Ä–µ–¥—å "–ø–æ–¥–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è" –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏—è —Å –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã–º–∏ –∫–ª—é—á–∞–º–∏** –ø—Ä–∏ –ø–æ–º–æ—â–∏ binding'–∞.

### üîç –ü—Ä–∏–º–µ—Ä—ã:

Direct:

```
Routing Key: order.created
Binding Key: order.created
‚Üí –°–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ø–∞–¥—ë—Ç –≤ –æ—á–µ—Ä–µ–¥—å
```

Topic:

```
Routing Key: user.profile.updated
Binding Key: user.*
‚Üí –°–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ø–∞–¥—ë—Ç –≤ –æ—á–µ—Ä–µ–¥—å

Routing Key: user.profile.updated
Binding Key: user.#
‚Üí –¢–æ–∂–µ –ø–æ–ø–∞–¥—ë—Ç, —Ç–∞–∫ –∫–∞–∫ # ‚Äî –ø–æ–¥—Å—Ç–∞–Ω–æ–≤–æ—á–Ω—ã–π —à–∞–±–ª–æ–Ω
```

### –†–∞–∑–Ω–∏—Ü–∞ –º–µ–∂–¥—É `*` –∏ `#` –≤ routing key —à–∞–±–ª–æ–Ω–∞—Ö

| –°–∏–º–≤–æ–ª | –ó–Ω–∞—á–µ–Ω–∏–µ                              |
| ------ | ------------------------------------- |
| `*`    | –ó–∞–º–µ–Ω—è–µ—Ç **—Ä–æ–≤–Ω–æ –æ–¥–Ω–æ** —Å–ª–æ–≤–æ (—Ç–æ–∫–µ–Ω) |
| `#`    | –ó–∞–º–µ–Ω—è–µ—Ç **–Ω–æ–ª—å –∏–ª–∏ –±–æ–ª–µ–µ** —Å–ª–æ–≤      |


**–ü—Ä–∏–º–µ—Ä—ã: –ö–∞–∫–∏–µ routing keys –ø–æ–ø–∞–¥—É—Ç –≤ –æ—á–µ—Ä–µ–¥—å?**

–£ –Ω–∞—Å –µ—Å—Ç—å –æ—á–µ—Ä–µ–¥—å —Å –ø—Ä–∏–≤—è–∑–∫–æ–π `Binding key: user.*.created`

| Routing Key                  | –°–æ–≤–ø–∞–¥–µ–Ω–∏–µ | –û–±—ä—è—Å–Ω–µ–Ω–∏–µ                                         |
| ---------------------------- | ---------- | -------------------------------------------------- |
| `user.profile.created`       | ‚úÖ          | `*` = `profile` (1 —Ç–æ–∫–µ–Ω –º–µ–∂–¥—É `user` –∏ `created`) |
| `user.a.created`             | ‚úÖ          | `*` = `a`                                          |
| `user.created`               | ‚ùå          | –Ω–µ—Ç –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω–æ–≥–æ —Ç–æ–∫–µ–Ω–∞                          |
| `user.profile.extra.created` | ‚ùå          | —Å–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ —Ç–æ–∫–µ–Ω–æ–≤                              |

–ï—Å–ª–∏ –æ—á–µ—Ä–µ–¥—å —Å –ø—Ä–∏–≤—è–∑–∫–æ–π: `Binding key: user.#.created`

| Routing Key                     | –°–æ–≤–ø–∞–¥–µ–Ω–∏–µ | –û–±—ä—è—Å–Ω–µ–Ω–∏–µ               |
| ------------------------------- | ---------- | ------------------------ |
| `user.created`                  | ‚úÖ          | `#` = 0 —Å–ª–æ–≤             |
| `user.profile.created`          | ‚úÖ          | `#` = `profile`          |
| `user.profile.extra.created`    | ‚úÖ          | `#` = `profile.extra`    |
| `user.profile.extra.v1.created` | ‚úÖ          | `#` = `profile.extra.v1` |
## üì§ –ü—É–±–ª–∏–∫–∞—Ü–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π (Producer ‚Üí Exchange ‚Üí Queue)

1. **Producer** –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ (TCP) –∏ —Å–æ–∑–¥–∞–µ—Ç **Channel**.
2. Producer –ø—É–±–ª–∏–∫—É–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ —Å —É–∫–∞–∑–∞–Ω–∏–µ–º:
    - Exchange (–∫—É–¥–∞ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å)
    - Routing key (–¥–ª—è –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏)
    - Headers (–µ—Å–ª–∏ –Ω—É–∂–µ–Ω headers exchange)
    - Body (–ø–æ–ª–µ–∑–Ω–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞)
3. **Exchange** –ø—Ä–∏–Ω–∏–º–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –∏ —Å–æ–ø–æ—Å—Ç–∞–≤–ª—è–µ—Ç –µ–≥–æ —Å –æ—á–µ—Ä–µ–¥—è–º–∏ –ø–æ –ø—Ä–∞–≤–∏–ª–∞–º:
    - Direct / Topic / Fanout / Headers
4. –°–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–º–µ—â–∞–µ—Ç—Å—è –≤ –ø–æ–¥—Ö–æ–¥—è—â–∏–µ **–æ—á–µ—Ä–µ–¥–∏** (–æ–¥–Ω—É –∏–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ).

### üîÅ Publisher Confirms vs Transactions

–ê —Ç–µ–ø–µ—Ä—å –∏–Ω—Ç–µ—Ä–µ—Å–Ω–∞—è —á–∞—Å—Ç—å ‚Äî –∫–∞–∫ –ø–æ–Ω—è—Ç—å, —á—Ç–æ **—Å–æ–æ–±—â–µ–Ω–∏–µ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –±—ã–ª–æ –¥–æ—Å—Ç–∞–≤–ª–µ–Ω–æ**?

1. Transactions
	- Producer –º–æ–∂–µ—Ç –Ω–∞—á–∞—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é, –æ–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ, –∞ –ø–æ—Ç–æ–º –µ—ë –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å (commit).
	- –≠—Ç–æ **–Ω–∞–¥–µ–∂–Ω–æ**, –Ω–æ **–º–µ–¥–ª–µ–Ω–Ω–æ** ‚Äî –∫–∞–∂–¥–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —Ç—Ä–µ–±—É–µ—Ç –ø–æ–ª–Ω–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏. –ò —Å–ª–µ–¥—É—é—â–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ.
2. Publisher Confirms
	- –ë–æ–ª–µ–µ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–π —Å–ø–æ—Å–æ–±: producer –ø–æ–ª—É—á–∞–µ—Ç **–∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ** –æ—Ç –±—Ä–æ–∫–µ—Ä–∞, —á—Ç–æ —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—É—á–µ–Ω–æ –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ.
	- –≠—Ç–æ **–Ω–∞–º–Ω–æ–≥–æ –±—ã—Å—Ç—Ä–µ–µ**, –æ—Å–æ–±–µ–Ω–Ω–æ –≤ –≤—ã—Å–æ–∫–æ–Ω–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö —Å–∏—Å—Ç–µ–º–∞—Ö. –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏—è –æ–¥–Ω–æ –∑–∞ –¥—Ä—É–≥–∏–º –∏ –ø–æ–ª—É—á–∞–µ–º `ack (Acknowledgement (–ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ))` –∏–ª–∏ `nack (Negative Acknowledgement (–æ—Ç–∫–∞–∑))` –∏ —Ä–µ–∞–≥–∏—Ä—É–µ–º –Ω–∞ —ç—Ç–æ. –ù–∞–ø—Ä–∏–º–µ—Ä, –µ—Å–ª–∏ —Å–æ–æ–±—â–µ–Ω–∏–µ –Ω–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ publisher, —Ç–æ –µ–≥–æ –º–æ–∂–Ω–æ –µ—â–µ —Ä–∞–∑ –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –∏–ª–∏ –ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å –æ—à–∏–±–∫—É.

## üì• –í—ã—á–∏—Ç–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π (Consumer ‚Üê Queue)

1. Consumer –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫ RabbitMQ –∏ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç **Channel**.
2. –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∫–æ–º–∞–Ω–¥—É `basicConsume`, –ø–æ–¥–ø–∏—Å—ã–≤–∞—è—Å—å –Ω–∞ –æ—á–µ—Ä–µ–¥—å.
3. RabbitMQ **–ø—É—à–∏—Ç —Å–æ–æ–±—â–µ–Ω–∏—è** –≤ Consumer –ø–æ TCP (Push-–º–æ–¥–µ–ª—å).
4. Consumer:
    - –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ
    - –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç `ACK` (–µ—Å–ª–∏ –∞–≤—Ç–æ-–ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –≤—ã–∫–ª—é—á–µ–Ω–æ)

### –ü–æ–¥ –∫–∞–ø–æ—Ç–æ–º –ø—Ä–∏ –≤—ã—á–∏—Ç–∫–µ

| –ú–µ—Ö–∞–Ω–∏–∑–º           | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ                                                  |
| ------------------ | ----------------------------------------------------------- |
| **Prefetch (QoS)** | –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ—Ç —á–∏—Å–ª–æ –Ω–µ–ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π               |
| **Manual ack**     | –ü–æ–∑–≤–æ–ª—è–µ—Ç —Ç–æ—á–Ω–æ –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä–æ–≤–∞—Ç—å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ                |
| **Auto-ack**       | –°–æ–æ–±—â–µ–Ω–∏–µ —Å—á–∏—Ç–∞–µ—Ç—Å—è –ø—Ä–∏–Ω—è—Ç—ã–º —Å—Ä–∞–∑—É (—Ä–∏—Å–∫ –ø–æ—Ç–µ—Ä–∏ –ø—Ä–∏ —Å–±–æ–µ)   |
| **Nack / Reject**  | –Ø–≤–Ω—ã–π –æ—Ç–∫–∞–∑ –æ—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏, –º–æ–∂–Ω–æ –≤–µ—Ä–Ω—É—Ç—å –≤ –æ—á–µ—Ä–µ–¥—å –∏–ª–∏ –≤ DLQ |

## üéØ –°—Ü–µ–Ω–∞—Ä–∏–π "–∏–∑ –∂–∏–∑–Ω–∏"

> –û–¥–∏–Ω —Å–µ—Ä–≤–∏—Å –ø—É–±–ª–∏–∫—É–µ—Ç —Å–æ–±—ã—Ç–∏—è –≤ `event.exchange` —Å routing key `order.created`, –∫–æ—Ç–æ—Ä—ã–µ –¥–æ—Å—Ç–∞–≤–ª—è—é—Ç—Å—è –≤ –æ—á–µ—Ä–µ–¥—å `billing.queue`. –ö–æ–Ω—Å—å—é–º–µ—Ä –∏–∑ `billing-service` –ø–æ–¥–ø–∏—Å–∞–Ω –Ω–∞ `billing.queue`, –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Å–æ–±—ã—Ç–∏—è –∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç –∏—Ö –≤—Ä—É—á–Ω—É—é. –ü—Ä–∏ –æ—à–∏–±–∫–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –≤ DLQ.

### –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –µ—Å–ª–∏ –∫–æ–Ω—Å—å—é–º–µ—Ä –Ω–µ –æ–±—Ä–∞–±–æ—Ç–∞–ª —Å–æ–æ–±—â–µ–Ω–∏–µ?

- –°–æ–æ–±—â–µ–Ω–∏—è –æ—Ç –ø—Ä–æ–¥—é—Å–µ—Ä–∞ –∏–¥—É—Ç –≤ –æ—Å–Ω–æ–≤–Ω—É—é –æ—á–µ—Ä–µ–¥—å —á–µ—Ä–µ–∑ –æ—Å–Ω–æ–≤–Ω–æ–π –æ–±–º–µ–Ω–Ω–∏–∫.
- –ï—Å–ª–∏ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—å –Ω–µ –º–æ–∂–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ, –æ–Ω –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –µ–≥–æ –≤ **retry exchange**, –∫–æ—Ç–æ—Ä—ã–π –Ω–∞–ø—Ä–∞–≤–ª—è–µ—Ç –≤ **retry –æ—á–µ—Ä–µ–¥—å** —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π (TTL = 60 —Å–µ–∫—É–Ω–¥).
- –ü–æ—Å–ª–µ –∏—Å—Ç–µ—á–µ–Ω–∏—è TTL, —Å–æ–æ–±—â–µ–Ω–∏–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –æ–±—Ä–∞—Ç–Ω–æ –≤ –æ—Å–Ω–æ–≤–Ω—É—é –æ—á–µ—Ä–µ–¥—å —á–µ—Ä–µ–∑ DLX.
- –ï—Å–ª–∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ø—ã—Ç–æ–∫ –ø—Ä–µ–≤—ã—à–µ–Ω–æ, —Å–æ–æ–±—â–µ–Ω–∏–µ –º–æ–∂–Ω–æ –Ω–∞–ø—Ä–∞–≤–∏—Ç—å –≤ **DLQ** (dead-letter queue) –¥–ª—è –ø–æ—Å–ª–µ–¥—É—é—â–µ–≥–æ –∞–Ω–∞–ª–∏–∑–∞.

```css
[Producer]
     |
     v
[Main Exchange]
     |
     v
[Main Queue] ---> [Consumer]
                     |
                (nack or fail)
                     |
                     v
             [Retry Exchange]
                     |
                     v
          [Retry Queue (TTL=60s)]
                     |
         (message expires via TTL)
                     |
                     v
             [Main Exchange]  <---+
                                |
                     +------------+
                     |
               [DLQ] (–µ—Å–ª–∏ –º–∞–∫—Å. –ø–æ–ø—ã—Ç–∫–∏ –∏—Å—á–µ—Ä–ø–∞–Ω—ã)

```

## üì§ Push vs Pull: –º–æ–¥–µ–ª—å –¥–æ—Å—Ç–∞–≤–∫–∏ –≤ RabbitMQ

üëâ **RabbitMQ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç push-–º–æ–¥–µ–ª—å –¥–æ—Å—Ç–∞–≤–∫–∏**.

- **Push** ‚Äî –±—Ä–æ–∫–µ—Ä —Å–∞–º **–æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç** —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—è–º, –∫–∞–∫ —Ç–æ–ª—å–∫–æ –æ–Ω–∏ –ø–æ—è–≤–ª—è—é—Ç—Å—è –≤ –æ—á–µ—Ä–µ–¥–∏.
- –í –æ—Ç–ª–∏—á–∏–µ –æ—Ç Kafka, –≥–¥–µ **–ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—å —Å–∞–º –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç** (`pull`) –¥–∞–Ω–Ω—ã–µ, –≤ RabbitMQ –æ–Ω–∏ –ø—Ä–∏—Ö–æ–¥—è—Ç "—Å–∞–º–∏".


ü§î –ü–æ—á–µ–º—É —ç—Ç–æ –≤–∞–∂–Ω–æ?
–ü–æ—Ç–æ–º—É —á—Ç–æ push-–º–æ–¥–µ–ª—å:
- –±—ã—Å—Ç—Ä–µ–µ –¥–ª—è –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π
- –Ω–æ –º–æ–∂–µ—Ç –ø–µ—Ä–µ–≥—Ä—É–∂–∞—Ç—å –º–µ–¥–ª–µ–Ω–Ω—ã—Ö –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–µ–π (–∏ —Ç—É—Ç –≤–∞–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `prefetch`)

### üîÑ Round-Robin –∏ Prefetch

 1. üåÄ Round-Robin (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
RabbitMQ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏—è **–ø–æ –æ—á–µ—Ä–µ–¥–∏** –º–µ–∂–¥—É –≤—Å–µ–º–∏ –∞–∫—Ç–∏–≤–Ω—ã–º–∏ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—è–º–∏.
–ù–∞–ø—Ä–∏–º–µ—Ä, –µ—Å–ª–∏ —É —Ç–µ–±—è 3 –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—è –∏ 6 —Å–æ–æ–±—â–µ–Ω–∏–π, —Ç–æ –∫–∞–∂–¥—ã–π –ø–æ–ª—É—á–∏—Ç –ø–æ 2.
üß† –ù–æ —ç—Ç–æ —Ç–æ–ª—å–∫–æ **–µ—Å–ª–∏ prefetch –Ω–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω**.

2. üéõÔ∏è Prefetch
–ü–∞—Ä–∞–º–µ—Ç—Ä `basic.qos(prefetch_count=N)` –∑–∞–¥–∞—ë—Ç, **—Å–∫–æ–ª—å–∫–æ —Å–æ–æ–±—â–µ–Ω–∏–π –º–æ–∂–µ—Ç –±—ã—Ç—å –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—é –±–µ–∑ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è** (`ack`).

–ù–∞–ø—Ä–∏–º–µ—Ä:
- `prefetch = 1`: RabbitMQ –ø–æ–¥–æ–∂–¥—ë—Ç, –ø–æ–∫–∞ —Ç—ã –æ–±—Ä–∞–±–æ—Ç–∞–µ—à—å –æ–¥–Ω–æ —Å–æ–æ–±—â–µ–Ω–∏–µ, –ø—Ä–µ–∂–¥–µ —á–µ–º –¥–∞—Ç—å —Ç–µ–±–µ —Å–ª–µ–¥—É—é—â–µ–µ.
- –≠—Ç–æ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç "–ø–µ—Ä–µ–∫–æ—Å", –∫–æ–≥–¥–∞ –æ–¥–∏–Ω –±—ã—Å—Ç—Ä—ã–π –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—å –ø–æ–ª—É—á–∞–µ—Ç —Å–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ, –∞ –¥—Ä—É–≥–∏–µ –ø—Ä–æ—Å—Ç–∞–∏–≤–∞—é—Ç.
üìå **Prefetch –ø–æ–º–æ–≥–∞–µ—Ç —Å–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞—Ç—å –Ω–∞–≥—Ä—É–∑–∫—É** –º–µ–∂–¥—É –º–µ–¥–ª–µ–Ω–Ω—ã–º–∏ –∏ –±—ã—Å—Ç—Ä—ã–º–∏ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—è–º–∏.

### üîó Channel vs Connection

 **üîå Connection**
- –≠—Ç–æ **TCP-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ** –º–µ–∂–¥—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ–º –∏ RabbitMQ —Å–µ—Ä–≤–µ—Ä–æ–º.
- ‚ùó –î–æ—Ä–æ–≥–æ–µ –≤ —Å–æ–∑–¥–∞–Ω–∏–∏. –ß–∞—Å—Ç–æ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –æ–¥–∏–Ω —Ä–∞–∑ –∏ –∂–∏–≤—ë—Ç –¥–æ–ª–≥–æ.

**üîÑ Channel**
- –≠—Ç–æ **–ª–æ–≥–∏—á–µ—Å–∫–æ–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –≤–Ω—É—Ç—Ä–∏ TCP-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è**.
- –õ—ë–≥–∫–∏–π, –±—ã—Å—Ç—Ä—ã–π.
- –ù–∞ –æ–¥–Ω–æ–º —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–∏ –º–æ–∂–Ω–æ –æ—Ç–∫—Ä—ã—Ç—å **–º–Ω–æ–≥–æ –∫–∞–Ω–∞–ª–æ–≤** ‚Äî –ø–æ –æ–¥–Ω–æ–º—É –Ω–∞ –∫–∞–∂–¥—ã–π –ø–æ—Ç–æ–∫, –Ω–∞–ø—Ä–∏–º–µ—Ä.
- –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è: **–æ–¥–∏–Ω –∫–∞–Ω–∞–ª –Ω–∞ –æ–¥–∏–Ω –ø–æ—Ç–æ–∫** (–≤ –º–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω–æ–π —Å—Ä–µ–¥–µ).
üìå Channels ‚Äî —ç—Ç–æ —Ç–æ, –≥–¥–µ —Ç—ã –ø—É–±–ª–∏–∫—É–µ—à—å, –ø–æ–¥–ø–∏—Å—ã–≤–∞–µ—à—å—Å—è, –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—à—å, –∏ —Ç.–ø.

üöß –û—á–µ–Ω—å –∂–µ–ª–∞—Ç–µ–ª—å–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø—Ä–∏–Ω—Ü–∏–ø –æ–¥–∏–Ω –ø–æ—Ç–æ–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è = –æ–¥–∏–Ω channel. –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –∏–∑–±–µ–∂–∞—Ç—å race condition. –†–∏—Å–∫–∏ –∫–æ–≥–¥–∞ –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø–æ—Ç–æ–∫–æ–≤ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –æ–¥–∏–Ω channel —ç—Ç–æ —Å–º–µ—à–µ–Ω–∏–µ –∫–æ–º–∞–Ω–¥ (—Å–æ–æ–±—â–µ–Ω–∏–µ —É—à–ª–æ, –Ω–æ –Ω–µ —Ç—É–¥–∞ –∏–ª–∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –±—ã–ª–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –Ω–µ —Ç–æ–º—É —Å–æ–æ–±—â–µ–Ω–∏—é)

‚úÖ –ò–¥–µ–∞–ª—å–Ω—ã–π –ø–æ–¥—Ö–æ–¥:
> –û–¥–∏–Ω –ø–æ—Ç–æ–∫ = –û–¥–∏–Ω channel (–≤ —Ä–∞–º–∫–∞—Ö –æ–¥–Ω–æ–≥–æ –æ–±—â–µ–≥–æ connection)

```bash
[Connection] ‚Üê –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –æ–¥–∏–Ω —Ä–∞–∑, —à–∞—Ä–∏—Ç—Å—è
     ‚îú‚îÄ‚îÄ [Channel 1] ‚Üê –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ü–æ—Ç–æ–∫–æ–º 1
     ‚îú‚îÄ‚îÄ [Channel 2] ‚Üê –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ü–æ—Ç–æ–∫–æ–º 2
     ‚îî‚îÄ‚îÄ [Channel N] ‚Üê –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ü–æ—Ç–æ–∫–æ–º N

```

üîß –í Java —ç—Ç–æ –æ–±—ã—á–Ω–æ –¥–µ–ª–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑:
- –ü—É–ª —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π (–Ω–∞–ø—Ä–∏–º–µ—Ä, `CachingConnectionFactory` –≤ Spring AMQP)
- –ü–æ—Ç–æ–∫–æ–±–µ–∑–æ–ø–∞—Å–Ω—ã–µ —Ñ–∞–±—Ä–∏–∫–∏ –∫–∞–Ω–∞–ª–æ–≤
- –û–±—ë—Ä—Ç–∫–∏, –∫–æ—Ç–æ—Ä—ã–µ —Å–æ–∑–¥–∞—é—Ç **channel –Ω–∞ –ø–æ—Ç–æ–∫**, –∏ –∑–∞–∫—Ä—ã–≤–∞—é—Ç –µ–≥–æ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –ø—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏

 –î–æ–ª–≥–æ–∂–∏–≤—É—â–∏–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è (—Ä–µ–∞–ª—å–Ω—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π):
- –°–æ–∑–¥–∞—ë—à—å **–æ–¥–∏–Ω connection** –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- –ù–∞ –∫–∞–∂–¥—ã–π –ø–æ—Ç–æ–∫ —Å–æ–∑–¥–∞—ë—à—å –∫–∞–Ω–∞–ª:
```java
Channel channel = connection.createChannel();
// —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—à—å shutdown hook –∏–ª–∏ –ª–æ–≤–∏—à—å –∏—Å–∫–ª—é—á–µ–Ω–∏—è
channel.close();
```

## –ü–æ–ª–µ–∑–Ω—ã–µ —Å–æ–≤–µ—Ç—ã:

- –ü—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è ‚Äî **–≤—Å–µ–≥–¥–∞ –∑–∞–∫—Ä—ã–≤–∞–π connection**, –∏–Ω–∞—á–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –æ—Å—Ç–∞–Ω–µ—Ç—Å—è –≤–∏—Å–µ—Ç—å –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ.
- –ü—Ä–∏ –∏—Å–∫–ª—é—á–µ–Ω–∏—è—Ö (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—å —É–ø–∞–ª) ‚Äî **–ª–æ–≤–∏ –∏ –∑–∞–∫—Ä—ã–≤–∞–π –∫–∞–Ω–∞–ª**.
- –í Spring AMQP ‚Äî –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `@PreDestroy` –∏–ª–∏ `DisposableBean` –¥–ª—è –æ—á–∏—Å—Ç–∫–∏.

## üßµ –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –≤—ã—á–∏—Ç–∫–∞ –∏ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ

RabbitMQ –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ—Ç—Å—è –ø–æ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª–∏ —á–µ—Ä–µ–∑:

 ‚úÖ –ù–µ—Å–∫–æ–ª—å–∫–æ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–µ–π –Ω–∞ –æ–¥–Ω—É –æ—á–µ—Ä–µ–¥—å
- –ù–µ—Å–∫–æ–ª—å–∫–æ –∫–æ–Ω—Å—å—é–º–µ—Ä–æ–≤ (–≤ —Ä–∞–∑–Ω—ã—Ö –ø–æ—Ç–æ–∫–∞—Ö/–∏–Ω—Å—Ç–∞–Ω—Å–∞—Ö) —á–∏—Ç–∞—é—Ç **–æ–¥–Ω—É –æ—á–µ—Ä–µ–¥—å**
- RabbitMQ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏—è **round-robin** (–µ—Å–ª–∏ –Ω–µ—Ç prefetch!)
üìå –≠—Ç–æ —Å–ø–æ—Å–æ–± –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞—Ç—å **–ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—É—é –æ–±—Ä–∞–±–æ—Ç–∫—É**
---
 ‚úÖ –ù–µ—Å–∫–æ–ª—å–∫–æ –æ—á–µ—Ä–µ–¥–µ–π (sharding)
- –ö–∞–∂–¥–∞—è –æ—á–µ—Ä–µ–¥—å –æ–±—Å–ª—É–∂–∏–≤–∞–µ—Ç —Å–≤–æ—é —á–∞—Å—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–π (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø–æ ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)
- –ö–∞–∂–¥—ã–π consumer —á–∏—Ç–∞–µ—Ç —Å–≤–æ—é –æ—á–µ—Ä–µ–¥—å
üìå –≠—Ç–æ —É–∂–µ **—à–∞—Ä–¥–∏–Ω–≥**, –¥–∞—ë—Ç –µ—â—ë –±–æ–ª—å—à–∏–π –∫–æ–Ω—Ç—Ä–æ–ª—å

## ‚öñÔ∏è Prefetch count ‚Äî –±–∞–ª–∞–Ω—Å –º–µ–∂–¥—É —Å–∫–æ—Ä–æ—Å—Ç—å—é –∏ —Å–ø—Ä–∞–≤–µ–¥–ª–∏–≤–æ—Å—Ç—å—é

 `prefetch=1`
- –ö–∞–∂–¥–æ–º—É –∫–æ–Ω—Å—å—é–º–µ—Ä—É –¥–∞—ë—Ç—Å—è **–æ–¥–Ω–æ —Å–æ–æ–±—â–µ–Ω–∏–µ –∑–∞ —Ä–∞–∑**
- –û—Ç–ª–∏—á–Ω–æ –¥–ª—è –º–µ–¥–ª–µ–Ω–Ω—ã—Ö –∑–∞–¥–∞—á, —á—Ç–æ–±—ã –Ω–µ –ø–µ—Ä–µ–≥—Ä—É–∂–∞—Ç—å –Ω–∏–∫–æ–≥–æ
- üìâ –ù–∏–∑–∫–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å, –Ω–æ üìà —Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞

 `prefetch=N`
- RabbitMQ –º–æ–∂–µ—Ç –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Å—Ä–∞–∑—É **N —Å–æ–æ–±—â–µ–Ω–∏–π** –∫–æ–Ω—Å—å—é–º–µ—Ä—É
- –£–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç throughput (—á–µ—Ä–µ–∑put)
- –ù–æ! –ë—ã—Å—Ç—Ä—ã–µ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–∏ –º–æ–≥—É—Ç "–∑–∞—Ö–≤–∞—Ç–∏—Ç—å" –±–æ–ª—å—à–µ, –∞ –º–µ–¥–ª–µ–Ω–Ω—ã–µ –ø—Ä–æ—Å—Ç–∞–∏–≤–∞—Ç—å
üéØ –ù–∞–¥–æ –ø–æ–¥–±–∏—Ä–∞—Ç—å `prefetch` –ø–æ —Ç–∏–ø—É –Ω–∞–≥—Ä—É–∑–∫–∏ –∏ —á–∏—Å–ª—É –ø–æ—Ç–æ–∫–æ–≤

## ‚ùå –ü—Ä–æ–±–ª–µ–º–∞ –¥—É–±–ª–∏—Ä—É—é—â–∏—Ö—Å—è —Å–æ–æ–±—â–µ–Ω–∏–π –∏ –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å

–í–æ—Ç —Ä–µ–∞–ª—å–Ω–∞—è –±–æ–ª—å. –í RabbitMQ **–≥–∞—Ä–∞–Ω—Ç–∏—è ‚Äî at least once**, –∑–Ω–∞—á–∏—Ç:
> –°–æ–æ–±—â–µ–Ω–∏–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –¥–æ—Å—Ç–∞–≤–ª–µ–Ω–æ **–ø–æ–≤—Ç–æ—Ä–Ω–æ** (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø–æ—Å–ª–µ —Å–±–æ—è –¥–æ `ack`)

---

üîÑ –ß—Ç–æ —Å —ç—Ç–∏–º –¥–µ–ª–∞—Ç—å?

üëâ **–ò–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞** ‚Äî –æ–±—Ä–∞–±–æ—Ç–∫–∞, –∫–æ—Ç–æ—Ä–∞—è –Ω–µ –∏–∑–º–µ–Ω—è–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ–º –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏.

**–ü—Ä–∏–º–µ—Ä—ã:**
- –ü—Ä–æ–≤–µ—Ä–∫–∞: ‚Äú–æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–ª –ª–∏ —è —ç—Ç–æ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å —Ç–∞–∫–∏–º ID?‚Äù
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –±–∞–∑—ã —Å `unique constraint` –ø–æ `message_id`
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Redis –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è `processed_message_ids`
---
üìå –í–∞–∂–Ω–æ:
- RabbitMQ **–Ω–µ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç**, —á—Ç–æ —Å–æ–æ–±—â–µ–Ω–∏–µ –ø—Ä–∏–¥—ë—Ç **—Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ä–∞–∑**
- –≠—Ç–æ –¥–æ–ª–∂–µ–Ω –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å **—Ç–≤–æ–π –∫–æ–¥**

# –£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –∏ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ Kafka

 üì¶ **Topic**
- –≠—Ç–æ –∫–∞–∫ ‚Äú–∫–∞—Ç–µ–≥–æ—Ä–∏—è —Å–æ–±—ã—Ç–∏–π‚Äù ‚Äî –ø–æ—Ç–æ–∫ —Å–æ–æ–±—â–µ–Ω–∏–π –Ω–∞ –æ–¥–Ω—É —Ç–µ–º—É.
- –ü—Ä–∏–º–µ—Ä: `user-activity`, `orders`, `logs`, `payment-failures`.
–¢—ã –∫–∞–∫ –±—ã –≥–æ–≤–æ—Ä–∏—à—å: ‚Äú–í–æ—Ç —Å—é–¥–∞ —è –±—É–¥—É —Å–∫–ª–∞–¥—ã–≤–∞—Ç—å –≤—Å–µ —Å–æ–±—ã—Ç–∏—è —Ç–∏–ø–∞ –•‚Äù.

 üîÄ **Partition**
 –ü–∞—Ä—Ç–∏—Ü–∏–∏ ‚Äî —ç—Ç–æ **—Ñ–∏–∑–∏—á–µ—Å–∫–æ–µ –¥–µ–ª–µ–Ω–∏–µ —Ç–æ–ø–∏–∫–∞** –Ω–∞ –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø–æ—Ç–æ–∫–æ–≤ –¥–∞–Ω–Ω—ã—Ö. –ö–∞–∂–¥–∞—è –ø–∞—Ä—Ç–∏—Ü–∏—è ‚Äî —ç—Ç–æ **—É–ø–æ—Ä—è–¥–æ—á–µ–Ω–Ω—ã–π, –Ω–µ–ø—Ä–µ—Ä—ã–≤–Ω—ã–π –ª–æ–≥** (append-only).
- –ö–∞–∂–¥—ã–π —Ç–æ–ø–∏–∫ –¥–µ–ª–∏—Ç—Å—è –Ω–∞ **–ø–∞—Ä—Ç–∏—Ü–∏–∏ (—Ä–∞–∑–¥–µ–ª—ã)** ‚Äî —ç—Ç–æ **–∫–ª—é—á –∫ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—é –∏ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–µ**.
- –°–æ–æ–±—â–µ–Ω–∏—è –≤ –ø–∞—Ä—Ç–∏—Ü–∏–∏ **—É–ø–æ—Ä—è–¥–æ—á–µ–Ω—ã**, –Ω–æ **–º–µ–∂–¥—É –ø–∞—Ä—Ç–∏—Ü–∏—è–º–∏ –ø–æ—Ä—è–¥–æ–∫ –Ω–µ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç—Å—è**.

–ü–∞—Ä—Ç–∏—Ü–∏–∏ –Ω—É–∂–Ω—ã, —á—Ç–æ–±—ã:
- —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –ø–æ –±—Ä–æ–∫–µ—Ä–∞–º
- –¥–∞–≤–∞—Ç—å –∫–∞–∂–¥–æ–º—É –∫–æ–Ω—Å—å—é–º–µ—Ä—É —Å–≤–æ—é "–¥–æ—Ä–æ–∂–∫—É"
- –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ

üìå –ò—Ç–æ–≥–æ:
> –û–¥–∏–Ω `topic` = N `partitions`
> –í –∫–∞–∂–¥–æ–π –ø–∞—Ä—Ç–∏—Ü–∏–∏ ‚Äî **—Å–≤–æ–π –ª–æ–≥** (append-only), —á–∏—Ç–∞–µ–º—ã–π –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ

**–ö–∞–∫ —Ñ–æ—Ä–º–∏—Ä—É—é—Ç—Å—è –ø–∞—Ä—Ç–∏—Ü–∏–∏?**

–ö–æ–≥–¥–∞ —Ç—ã —Å–æ–∑–¥–∞—ë—à—å —Ç–æ–ø–∏–∫, —Ç—ã —É–∫–∞–∑—ã–≤–∞–µ—à—å, —Å–∫–æ–ª—å–∫–æ —É –Ω–µ–≥–æ –±—É–¥–µ—Ç –ø–∞—Ä—Ç–∏—Ü–∏–π:

```bash
kafka-topics.sh --create --topic my-topic --partitions 3 ...
```

–¢–æ–≥–¥–∞ Kafka —Å–æ–∑–¥–∞—Å—Ç:
- `my-topic-0`
- `my-topic-1`
- `my-topic-2`

–ò –±—É–¥–µ—Ç —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ —ç—Ç–∏–º —á–∞—Å—Ç—è–º.

Producer –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ ‚Üí Kafka —Ä–µ—à–∞–µ—Ç:
- –ï—Å–ª–∏ —É–∫–∞–∑–∞–Ω **–∫–ª—é—á (key)** ‚Üí Kafka –ø—Ä–∏–º–µ–Ω—è–µ—Ç `hash(key) % partitions` ‚Üí –æ–¥–Ω–æ—Ç–∏–ø–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ–π–¥—É—Ç –≤ –æ–¥–Ω—É –∏ —Ç—É –∂–µ –ø–∞—Ä—Ç–∏—Ü–∏—é (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø–æ `userId`)
- –ï—Å–ª–∏ –∫–ª—é—á –Ω–µ —É–∫–∞–∑–∞–Ω ‚Üí Kafka –º–æ–∂–µ—Ç —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–∏—Ç—å **—Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–æ**

üëâ –ü—Ä–∏–º–µ—Ä:
–£ —Ç–µ–±—è –µ—Å—Ç—å —Ç–æ–ø–∏–∫ `user-actions` —Å 3 –ø–∞—Ä—Ç–∏—Ü–∏—è–º–∏:

| Partition 0 | Partition 1 | Partition 2 |
| ----------- | ----------- | ----------- |
| user 1      | user 2      | user 3      |
| user 4      | user 5      | user 6      |
–ü–∏—à–µ–º —Å –∫–ª—é—á–∞–º–∏ ‚Äî `userId`
‚Üí –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å 1 –≤—Å–µ–≥–¥–∞ –∏–¥—ë—Ç –≤ Partition 0
‚Üí –ø–æ—Ä—è–¥–æ–∫ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è **–≤–Ω—É—Ç—Ä–∏ –æ–¥–Ω–æ–π –ø–∞—Ä—Ç–∏—Ü–∏–∏**

‚ö†Ô∏è Kafka –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –ø–æ—Ä—è–¥–æ–∫ —Å–æ–æ–±—â–µ–Ω–∏–π —Ç–æ–ª—å–∫–æ –≤–Ω—É—Ç—Ä–∏ –æ–¥–Ω–æ–π –ø–∞—Ä—Ç–∏—Ü–∏–∏.

–¢–∞–∫ —á—Ç–æ –µ—Å–ª–∏ —É —Ç–µ–±—è —Å–æ–±—ã—Ç–∏—è:
1. `user.registered`
2. `user.emailConfirmed`
3. `user.passwordChanged`
–∏ –æ–Ω–∏ **—Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è—Ç—Å—è –ø–æ —Ä–∞–∑–Ω—ã–º –ø–∞—Ä—Ç–∏—Ü–∏—è–º**, —Ç–æ:
- –û–¥–∏–Ω consumer –º–æ–∂–µ—Ç –ø–æ–ª—É—á–∏—Ç—å `passwordChanged` —Ä–∞–Ω—å—à–µ `emailConfirmed` üò±
- –≠—Ç–æ –ø—Ä–∏–≤–µ–¥—ë—Ç –∫ **–ª–æ–≥–∏—á–µ—Å–∫–æ–π –æ—à–∏–±–∫–µ** –≤ –±–∏–∑–Ω–µ—Å-–ø—Ä–æ—Ü–µ—Å—Å–µ
## Producers, Brokers, Offset, Consumers

 üõ† **Producer**
- –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–±—ã—Ç–∏—è –≤ Kafka.
- –ú–æ–∂–µ—Ç —Å–∞–º —Ä–µ—à–∞—Ç—å, **–≤ –∫–∞–∫—É—é –ø–∞—Ä—Ç–∏—Ü–∏—é –ø–∏—Å–∞—Ç—å**:
    - –ü–æ –∫–ª—é—á—É (`key`) ‚Äî –Ω–∞–ø—Ä–∏–º–µ—Ä, –ø–æ `userId` –¥–ª—è —Å—Ç–∏–∫–µ—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –ø–æ—Ä—è–¥–∫–∞
    - –°–ª—É—á–∞–π–Ω–æ ‚Äî –¥–ª—è —Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–æ–π –Ω–∞–≥—Ä—É–∑–∫–∏

 üß± **Broker**
- –°–µ—Ä–≤–µ—Ä Kafka. –û–¥–∏–Ω Kafka-–±—Ä–æ–∫–µ—Ä ‚Äî —ç—Ç–æ —É–∑–µ–ª –≤ –∫–ª–∞—Å—Ç–µ—Ä–µ.
- –•—Ä–∞–Ω–∏—Ç –ø–∞—Ä—Ç–∏—Ü–∏–∏ –∏ –æ–±—Å–ª—É–∂–∏–≤–∞–µ—Ç –∑–∞–ø—Ä–æ—Å—ã –æ—Ç –ø—Ä–æ–¥—é—Å–µ—Ä–æ–≤ –∏ –∫–æ–Ω—Å—å—é–º–µ—Ä–æ–≤.

üìå –ù–µ—Å–∫–æ–ª—å–∫–æ –±—Ä–æ–∫–µ—Ä–æ–≤ = –∫–ª–∞—Å—Ç–µ—Ä Kafka
‚Üí –ü–∞—Ä—Ç–∏—Ü–∏–∏ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è—é—Ç—Å—è –ø–æ –Ω–∏–º

### üî¢ Offset
üìå Offset ‚Äî —ç—Ç–æ –ø—Ä–æ—Å—Ç–æ **–Ω–æ–º–µ—Ä —Å–æ–æ–±—â–µ–Ω–∏—è –≤ –ø–∞—Ä—Ç–∏—Ü–∏–∏**.

Kafka —Ö—Ä–∞–Ω–∏—Ç –≤—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ –∫–∞–∂–¥–æ–π –ø–∞—Ä—Ç–∏—Ü–∏–∏ **–≤ —Å—Ç—Ä–æ–≥–æ–º –ø–æ—Ä—è–¥–∫–µ**. –ò –∫–∞–∂–¥–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—É—á–∞–µ—Ç —Å–≤–æ–π **–ø–æ—Ä—è–¥–∫–æ–≤—ã–π –Ω–æ–º–µ—Ä**, –Ω–∞—á–∏–Ω–∞—è —Å 0:
```bash
Partition 0:
[0] User A –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–ª—Å—è
[1] User A –ø–æ–¥—Ç–≤–µ—Ä–¥–∏–ª email
[2] User A —Å–º–µ–Ω–∏–ª –ø–∞—Ä–æ–ª—å
```

### üì¶ –ü—Ä–∏–º–µ—Ä:
–¢—ã —á–∏—Ç–∞–µ—à—å Partition 0, –∏ –æ–±—Ä–∞–±–æ—Ç–∞–ª offset 1
‚Üí Kafka —Ç–µ–ø–µ—Ä—å –∑–Ω–∞–µ—Ç: ‚Äú–¢—ã –æ—Å—Ç–∞–Ω–æ–≤–∏–ª—Å—è –Ω–∞ 1, —Å–ª–µ–¥—É—é—â–µ–µ –±—É–¥–µ—Ç 2‚Äù

–ï—Å–ª–∏ —Ç—ã –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—à—å –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—è:
- –û–Ω –ø—Ä–æ–¥–æ–ª–∂–∏—Ç **—Å offset = 2**, –µ—Å–ª–∏ offset **—Å–æ—Ö—Ä–∞–Ω—ë–Ω**
- –ò–ª–∏ –Ω–∞—á–Ω—ë—Ç —Å–Ω–∞—á–∞–ª–∞ / —Å –∫–æ–Ω—Ü–∞ ‚Äî –µ—Å–ª–∏ offset **–Ω–µ —Å–æ—Ö—Ä–∞–Ω—ë–Ω**
### üßæ **Consumer**
- –ß–∏—Ç–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –∏–∑ –æ–¥–Ω–æ–π –∏–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –ø–∞—Ä—Ç–∏—Ü–∏–π.
- –ü–æ–¥–ø–∏—Å–∞–Ω –Ω–∞ –æ–¥–∏–Ω –∏–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ç–æ–ø–∏–∫–æ–≤.

## Offset **—Ö—Ä–∞–Ω–∏—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ –¥–ª—è –∫–∞–∂–¥–æ–π consumer group**

–¢–æ –µ—Å—Ç—å:
- –ì—Ä—É–ø–ø–∞ `analytics` –º–æ–∂–µ—Ç —á–∏—Ç–∞—Ç—å `orders` –∏ –±—ã—Ç—å –Ω–∞ offset 100
- –ì—Ä—É–ø–ø–∞ `billing` —á–∏—Ç–∞–µ—Ç —Ç–æ—Ç –∂–µ `orders`, –Ω–æ –Ω–∞ offset 70

üîÅ Kafka –Ω–µ —É–¥–∞–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ—Å–ª–µ —á—Ç–µ–Ω–∏—è ‚Äî —Ç—ã —Å–∞–º –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ—à—å, –≥–¥–µ —Ç—ã **–Ω–∞—Ö–æ–¥–∏—à—å—Å—è –≤ –∂—É—Ä–Ω–∞–ª–µ —Å–æ–±—ã—Ç–∏–π**

### üë• Consumer group
–≠—Ç–æ **–≥—Ä—É–ø–ø–∞ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–µ–π, –∫–æ—Ç–æ—Ä—ã–µ —á–∏—Ç–∞—é—Ç –æ–¥–∏–Ω –∏ —Ç–æ—Ç –∂–µ —Ç–æ–ø–∏–∫ –í–ú–ï–°–¢–ï**.
–ù–æ –∫–∞–∂–¥—ã–π –∏–∑ –Ω–∏—Ö —á–∏—Ç–∞–µ—Ç **—Ä–∞–∑–Ω—ã–µ –ø–∞—Ä—Ç–∏—Ü–∏–∏**, —á—Ç–æ–±—ã:
> üìå –û–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è **–ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ**, –Ω–æ **–Ω–µ –¥—É–±–ª–∏—Ä—É—è** –∏—Ö.

### üéØ –ü—Ä–∏–º–µ—Ä:
–î–æ–ø—É—Å—Ç–∏–º, —É —Ç–µ–±—è –µ—Å—Ç—å —Ç–æ–ø–∏–∫ `orders` —Å 3 –ø–∞—Ä—Ç–∏—Ü–∏—è–º–∏: `P0`, `P1`, `P2`.
–¢—ã –∑–∞–ø—É—Å–∫–∞–µ—à—å **3 –∫–æ–Ω—Å—å—é–º–µ—Ä–∞**, –∏ –¥–∞—ë—à—å –∏–º **–æ–¥–Ω–æ –∏ —Ç–æ –∂–µ –∏–º—è –≥—Ä—É–ø–ø—ã**, –Ω–∞–ø—Ä–∏–º–µ—Ä `order-processors`.

‚Üí Kafka –≥–æ–≤–æ—Ä–∏—Ç:
> "–ê–≥–∞, –≤—ã –≤—Å–µ –∏–∑ –æ–¥–Ω–æ–π –≥—Ä—É–ø–ø—ã. –¢–æ–≥–¥–∞ —è **–ø–æ–¥–µ–ª—é –ø–∞—Ä—Ç–∏—Ü–∏–∏ –º–µ–∂–¥—É –≤–∞–º–∏**."

```bash
P0 ‚Üí Consumer 1  ‚Ü∞
P1 ‚Üí Consumer 2   ‚Ü£ –æ–¥–Ω–∞ –≥—Ä—É–ø–ø–∞
P2 ‚Üí Consumer 3  ‚Ü≤
```

**–ì–ª–∞–≤–Ω–æ–µ –ø—Ä–∞–≤–∏–ª–æ:**
–í –æ–¥–Ω–æ–π consumer group, –æ–¥–Ω–∞ –ø–∞—Ä—Ç–∏—Ü–∏—è ‚Üí –æ–¥–Ω–æ–º—É –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—é ‚Üí –ß—Ç–æ–±—ã –Ω–µ –±—ã–ª–æ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è, –Ω–æ –≤—Å—è –≥—Ä—É–ø–ø–∞ –æ–±—Ä–∞–±–æ—Ç–∞–ª–∞ –≤—Å–µ –¥–∞–Ω–Ω—ã–µ

‚ùì–ß—Ç–æ –±—É–¥–µ—Ç –µ—Å–ª–∏ –¥–æ–±–∞–≤–∏—Ç—å `Consumer 4`?
- Consumer 4 –Ω–µ –±—É–¥–µ—Ç –ø–æ–ª—É—á–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è, —Ç–∞–∫ –∫–∞–∫ –µ–º—É –Ω–µ –¥–æ—Å—Ç–∞–Ω–µ—Ç—Å—è –ø–∞—Ä—Ç–∏—Ü–∏–∏

‚ùì–ü–æ–ª–µ–∑–µ–Ω –ª–∏ –∏–∑–±—ã—Ç–æ–∫ –∫–æ–Ω—Å—å—é–º–µ—Ä–æ–≤?
- –î–∞, –ø–æ—Ç–æ–º—É —á—Ç–æ –µ—Å–ª–∏ –∫—Ç–æ-—Ç–æ –∏–∑ –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–µ–π **–≤–¥—Ä—É–≥ —É–ø–∞–¥—ë—Ç**, Kafka —Å–∫–∞–∂–µ—Ç: ‚Äú–û, —É –º–µ–Ω—è –µ—Å—Ç—å —Å–≤–æ–±–æ–¥–Ω—ã–π —É—á–∞—Å—Ç–Ω–∏–∫!‚Äù ‚Üí –ò —Å–¥–µ–ª–∞–µ—Ç **rebalance**, –Ω–∞–∑–Ω–∞—á–∏–≤ –µ–º—É –ø–∞—Ä—Ç–∏—Ü–∏—é, –∫–æ—Ç–æ—Ä—É—é –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–ª —É–ø–∞–≤—à–∏–π.
üìå –¢–æ –µ—Å—Ç—å: **–¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∫–æ–Ω—Å—å—é–º–µ—Ä—ã = —Ä–µ–∑–µ—Ä–≤**

## –ü–µ—Ä–µ–ø–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∫–æ–Ω—Å—å—é–º–µ—Ä–æ–≤ –ø—Ä–∏ —Å–±–æ–µ

–î–æ–ø—É—Å—Ç–∏–º:
- –£ —Ç–µ–±—è –µ—Å—Ç—å —Ç–æ–ø–∏–∫ —Å 3 –ø–∞—Ä—Ç–∏—Ü–∏—è–º–∏: `P0`, `P1`, `P2`
- –ï—Å—Ç—å consumer group `order-processors` —Å 3 –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—è–º–∏: `C1`, `C2`, `C3`
- –ö–∞–∂–¥–æ–º—É –Ω–∞–∑–Ω–∞—á–µ–Ω–∞ —Å–≤–æ—è –ø–∞—Ä—Ç–∏—Ü–∏—è:
```
P0 ‚Üí C1
P1 ‚Üí C2
P2 ‚Üí C3
```

**‚ùå –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç, –µ—Å–ª–∏ `C2` (–æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—â–∏–π `P1`) —É–ø–∞–ª?**
Kafka –Ω–µ –º–æ–∂–µ—Ç ‚Äú—É–¥–µ—Ä–∂–∏–≤–∞—Ç—å‚Äù –ø–∞—Ä—Ç–∏—Ü–∏—é –∑–∞ —É–ø–∞–≤—à–∏–º –∫–æ–Ω—Å—å—é–º–µ—Ä–æ–º, –ø–æ—Ç–æ–º—É —á—Ç–æ:
> –í consumer group –ø–∞—Ä—Ç–∏—Ü–∏–∏ –Ω–µ –∑–∞–∫—Ä–µ–ø–ª–µ–Ω—ã –∂—ë—Å—Ç–∫–æ –∑–∞ –∫–æ–Ω—Å—å—é–º–µ—Ä–∞–º–∏ –Ω–∞–≤—Å–µ–≥–¥–∞.

**Kafka –∑–∞–ø—É—Å–∫–∞–µ—Ç rebalance:**
1. –í—Å–µ –æ—Å—Ç–∞–≤—à–∏–µ—Å—è –∂–∏–≤—ã–µ –∫–æ–Ω—Å—å—é–º–µ—Ä—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä, `C1` –∏ `C3`) **–æ—Ç–∫–ª—é—á–∞—é—Ç—Å—è –æ—Ç —Å–≤–æ–∏—Ö –ø–∞—Ä—Ç–∏—Ü–∏–π –≤—Ä–µ–º–µ–Ω–Ω–æ**
2. Kafka **–ø–µ—Ä–µ—Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è–µ—Ç –≤—Å–µ –ø–∞—Ä—Ç–∏—Ü–∏–∏ –∑–∞–Ω–æ–≤–æ** —Å—Ä–µ–¥–∏ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö
```
P0 ‚Üí C1
P1 ‚Üí C3
P2 ‚Üí C1
```
‚Üí –¢–µ–ø–µ—Ä—å `C3` –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç `P1`, –∫–æ—Ç–æ—Ä—É—é —Ä–∞–Ω—å—à–µ —á–∏—Ç–∞–ª `C2`

–í–∞–∂–Ω–æ:
- **Kafka –Ω–µ –ø—Ä–∏–≤—è–∑—ã–≤–∞–µ—Ç –ø–∞—Ä—Ç–∏—Ü–∏–∏ –∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º—É –∫–æ–Ω—Å—å—é–º–µ—Ä—É –Ω–∞–≤—Å–µ–≥–¥–∞**
- –ü–µ—Ä–µ—Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç **–∫–∞–∂–¥—ã–π —Ä–∞–∑**, –∫–æ–≥–¥–∞:
    - –∫–æ–Ω—Å—å—é–º–µ—Ä **—É—Ö–æ–¥–∏—Ç –∏–ª–∏ –ø–æ—è–≤–ª—è–µ—Ç—Å—è**
    - **—á–∏—Å–ª–æ –ø–∞—Ä—Ç–∏—Ü–∏–π** –∏–∑–º–µ–Ω—è–µ—Ç—Å—è
    - **—á–∏—Å–ª–æ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –≥—Ä—É–ø–ø—ã** –º–µ–Ω—è–µ—Ç—Å—è

üü° **–ö—Ç–æ –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –≥—Ä—É–ø–ø—ã?**
Kafka –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **Group Coordinator** ‚Äî —ç—Ç–æ –æ–¥–∏–Ω –∏–∑ –±—Ä–æ–∫–µ—Ä–æ–≤, –∫–æ—Ç–æ—Ä—ã–π:
- —Å–ª–µ–¥–∏—Ç –∑–∞ **–ø—É–ª—å—Å–æ–º** (heartbeat) –æ—Ç –∫–∞–∂–¥–æ–≥–æ –∫–æ–Ω—Å—å—é–º–µ—Ä–∞
- —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç offset'—ã
- –∑–∞–ø—É—Å–∫–∞–µ—Ç **rebalance**, –∫–æ–≥–¥–∞ –Ω—É–∂–Ω–æ

üü° **–ö–∞–∫ Kafka –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç, —á—Ç–æ consumer ‚Äú–ø—Ä–æ–ø–∞–ª‚Äù?**
–ö–æ–≥–¥–∞ —Ç—ã –∑–∞–ø—É—Å–∫–∞–µ—à—å `KafkaConsumer`, –æ–Ω:
1. –ü—Ä–∏—Å–æ–µ–¥–∏–Ω—è–µ—Ç—Å—è –∫ –≥—Ä—É–ø–ø–µ (—á–µ—Ä–µ–∑ `group.id`)
2. –†–µ–≥—É–ª—è—Ä–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç **heartbeat** –±—Ä–æ–∫–µ—Ä—É (Group Coordinator)
3. –ï—Å–ª–∏ heartbeat **–Ω–µ –ø—Ä–∏—Ö–æ–¥–∏—Ç –≤–æ–≤—Ä–µ–º—è**, –±—Ä–æ–∫–µ—Ä —Å—á–∏—Ç–∞–µ—Ç –µ–≥–æ **‚Äú–º–µ—Ä—Ç–≤—ã–º‚Äù**

üïí –í–∞–∂–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:

| –ü–∞—Ä–∞–º–µ—Ç—Ä                | –ó–Ω–∞—á–µ–Ω–∏–µ                                                                           |
| ----------------------- | ---------------------------------------------------------------------------------- |
| `session.timeout.ms`    | –°–∫–æ–ª—å–∫–æ –≤—Ä–µ–º–µ–Ω–∏ Kafka –∂–¥—ë—Ç heartbeat –ø–µ—Ä–µ–¥ —Ç–µ–º –∫–∞–∫ —Å—á–∏—Ç–∞—Ç—å –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—è "–ø—Ä–æ–ø–∞–≤—à–∏–º" |
| `heartbeat.interval.ms` | –ö–∞–∫ —á–∞—Å—Ç–æ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—å —à–ª—ë—Ç heartbeat                                               |
| `max.poll.interval.ms`  | –ú–∞–∫—Å. –≤—Ä–µ–º—è –º–µ–∂–¥—É `poll()` ‚Äî –∑–∞—â–∏—Ç–∞ –æ—Ç –∑–∞–≤–∏—Å–∞–Ω–∏—è                                   |

**üß® –ï—Å–ª–∏ heartbeat –Ω–µ –ø—Ä–∏—à—ë–ª ‚Üí —Ä–µ–±–∞–ª–∞–Ω—Å**
–ö–æ–≥–¥–∞ Kafka —Ä–µ—à–∞–µ—Ç, —á—Ç–æ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—å —É–º–µ—Ä:
- **–≤—Å—è –≥—Ä—É–ø–ø–∞ –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –≤ —Ä–µ–∂–∏–º —Ä–µ–±–∞–ª–∞–Ω—Å–∞**
- –ü–∞—Ä—Ç–∏—Ü–∏–∏ –ø–µ—Ä–µ—Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è—é—Ç—Å—è –º–µ–∂–¥—É –æ—Å—Ç–∞–≤—à–∏–º–∏—Å—è
- –ö–æ–Ω—Å—å—é–º–µ—Ä—ã –ø–æ–ª—É—á–∞—é—Ç –∫–æ–ª–ª–±–µ–∫: `onPartitionsRevoked` ‚Üí `onPartitionsAssigned`

**üß® –ï—Å–ª–∏ –∫–æ–Ω—Å—å—é–º–µ—Ä –Ω–µ –ø—Ä–∏—à–µ–ª –∑–∞ –Ω–æ–≤—ã–º —Å–æ–æ–±—â–µ–Ω–∏–µ –∑–∞ `max.poll.interval.ms`‚Üí —Ä–µ–±–∞–ª–∞–Ω—Å**
–ö–æ–≥–¥–∞ Kafka —Ä–µ—à–∞–µ—Ç, —á—Ç–æ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—å –∑–∞–≤–∏—Å, –¥–∞–∂–µ –µ—Å–ª–∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç heartbeat:
- **–≤—Å—è –≥—Ä—É–ø–ø–∞ –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –≤ —Ä–µ–∂–∏–º —Ä–µ–±–∞–ª–∞–Ω—Å–∞**
- –ü–∞—Ä—Ç–∏—Ü–∏–∏ –ø–µ—Ä–µ—Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è—é—Ç—Å—è –º–µ–∂–¥—É –æ—Å—Ç–∞–≤—à–∏–º–∏—Å—è
- –ö–æ–Ω—Å—å—é–º–µ—Ä—ã –ø–æ–ª—É—á–∞—é—Ç –∫–æ–ª–ª–±–µ–∫: `onPartitionsRevoked` ‚Üí `onPartitionsAssigned`

‚ùì–ï—Å–ª–∏ –æ–¥–∏–Ω –∫–æ–Ω—Å—å—é–º–µ—Ä –≤ –≥—Ä—É–ø–ø–µ –¥–æ–ª–≥–æ –æ–±—Ä–∞–±–∞—ã–≤–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏—è ‚Äî –±–ª–æ–∫–∏—Ä—É–µ—Ç –ª–∏ –æ–Ω –¥—Ä—É–≥–∏—Ö –Ω–∞ –ø—Ä–æ—á—Ç–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π?
**–ù–µ—Ç, –Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç.**
‚Üí –ü–æ—Ç–æ–º—É —á—Ç–æ:
> –ö–∞–∂–¥–∞—è –ø–∞—Ä—Ç–∏—Ü–∏—è –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ, –∏ offset —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ –¥–ª—è –∫–∞–∂–¥–æ–π –ø–∞—Ä—Ç–∏—Ü–∏–∏ –∏ consumer group.

 üéØ –ö–ª—é—á–µ–≤—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã:
1. **Offset —Ö—Ä–∞–Ω–∏—Ç—Å—è –ø–æ —Å—Ö–µ–º–µ:**

```
<consumer group ID> + <partition ID> ‚Üí offset
```

‚Üí –¢–æ –µ—Å—Ç—å:
- –ù–µ –æ–¥–∏–Ω offset –Ω–∞ –≤—Å—é –≥—Ä—É–ø–ø—É!
- –£ –∫–∞–∂–¥–æ–π –ø–∞—Ä—Ç–∏—Ü–∏–∏ —Å–≤–æ–π offset

üìå –ü–æ—ç—Ç–æ–º—É, –¥–∞–∂–µ –µ—Å–ª–∏ –æ–¥–∏–Ω consumer –∑–∞–≤–∏—Å:
- –û–Ω –±–ª–æ–∫–∏—Ä—É–µ—Ç **—Ç–æ–ª—å–∫–æ —Å–≤–æ–∏ –ø–∞—Ä—Ç–∏—Ü–∏–∏**
- –û—Å—Ç–∞–ª—å–Ω—ã–µ –∫–æ–Ω—Å—å—é–º–µ—Ä—ã –ø—Ä–æ–¥–æ–ª–∂–∞—é—Ç –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å —Å–≤–æ–∏

2. **–ö–æ–Ω—Å—å—é–º–µ—Ä—ã –Ω–µ –∑–∞–≤–∏—Å—è—Ç –¥—Ä—É–≥ –æ—Ç –¥—Ä—É–≥–∞**
–ï—Å–ª–∏:
- `C1` –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç `P0` –∏ –∑–∞–≤–∏—Å
- `C2` –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç `P1` ‚Äî –æ–Ω –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å!
- Kafka –Ω–∏–∫–∞–∫ –Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç `C2`

2. **–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ = commit offset**
–ö–æ–Ω—Å—å—é–º–µ—Ä:
- —á–∏—Ç–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, offset = 101)
- –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –µ–≥–æ
- –∑–∞—Ç–µ–º –¥–µ–ª–∞–µ—Ç **commit(offset = 102)**
    ‚Üí —ç—Ç–æ –≥–æ–≤–æ—Ä–∏—Ç Kafka: "—è –æ–±—Ä–∞–±–æ—Ç–∞–ª –≤—Å—ë –¥–æ 101 –≤–∫–ª—é—á–∏—Ç–µ–ª—å–Ω–æ"

üìå Commit –º–æ–∂–µ—Ç –±—ã—Ç—å:
- –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º (`enable.auto.commit=true`)
- —Ä—É—á–Ω—ã–º (`commitSync()` –∏–ª–∏ `commitAsync()`)

‚ö†Ô∏è –ï—Å–ª–∏ consumer **–æ–±—Ä–∞–±–æ—Ç–∞–ª —Å–æ–æ–±—â–µ–Ω–∏–µ**, –Ω–æ **–Ω–µ —Å–¥–µ–ª–∞–ª commit offset**:
‚Üí Kafka **–Ω–µ –∑–Ω–∞–µ—Ç**, —á—Ç–æ —Å–æ–æ–±—â–µ–Ω–∏–µ –±—ã–ª–æ —É—Å–ø–µ—à–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ
‚Üí –ó–Ω–∞—á–∏—Ç, **offset –Ω–µ —Å–¥–≤–∏–≥–∞–µ—Ç—Å—è**
‚Üí –ü—Ä–∏ —Å–ª–µ–¥—É—é—â–µ–º –∑–∞–ø—É—Å–∫–µ consumer:
- –û–Ω –ø–æ–ª—É—á–∏—Ç **—Ç–æ –∂–µ —Å–∞–º–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å–Ω–æ–≤–∞**
- –ü–æ—Ç–æ–º—É —á—Ç–æ Kafka –¥—É–º–∞–µ—Ç: ‚Äú—Ç—ã –µ–≥–æ –µ—â—ë –Ω–µ —á–∏—Ç–∞–ª!‚Äù

üìå –ü–æ—ç—Ç–æ–º—É –≤—Å–µ–≥–¥–∞:
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å **–∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ–π**
- Offset'—ã –Ω—É–∂–Ω–æ **–∫–æ–º–º–∏—Ç–∏—Ç—å –≤—Ä—É—á–Ω—É—é**, –µ—Å–ª–∏ —Ç—ã —Ö–æ—á–µ—à—å –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä–æ–≤–∞—Ç—å –Ω–∞–¥—ë–∂–Ω–æ—Å—Ç—å
# –ò—Ç–æ–≥

## ‚úÖ –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å **Kafka**:

- üîÅ **–í–∞–∂–µ–Ω –ø–æ—Ä—è–¥–æ–∫ —Å–æ–±—ã—Ç–∏–π** –≤–Ω—É—Ç—Ä–∏ –∫–ª—é—á–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `userId`)
- ‚è≥ **–•–æ—á–µ—à—å —Ö—Ä–∞–Ω–∏—Ç—å —Å–æ–±—ã—Ç–∏—è –¥–æ–ª–≥–æ** (–Ω–∞–ø—Ä–∏–º–µ—Ä, 7 –¥–Ω–µ–π –∏–ª–∏ –±–æ–ª—å—à–µ)
- üìä **–ù—É–∂–Ω–æ —á–∏—Ç–∞—Ç—å –æ–¥–∏–Ω –∏ —Ç–æ—Ç –∂–µ –ø–æ—Ç–æ–∫ —Ä–∞–∑–Ω—ã–º–∏ —Å–µ—Ä–≤–∏—Å–∞–º–∏**, –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ (consumer groups)
- üîÑ **–ù—É–∂–Ω–æ –ø–µ—Ä–µ—á–∏—Ç—ã–≤–∞—Ç—å —Å–æ–±—ã—Ç–∏—è** (replay), –ø–µ—Ä–µ–º–µ—â–∞—è offset –Ω–∞–∑–∞–¥
- üöÄ **–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—à—å –±–æ–ª—å—à–∏–µ –æ–±—ä–µ–º—ã –¥–∞–Ω–Ω—ã—Ö –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏** ‚Äî –ª–æ–≥–∏, –∞–Ω–∞–ª–∏—Ç–∏–∫–∞, –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

üìå Kafka = –ø–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö (stream), –æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –Ω–∞ **–ª–æ–≥ —Å–æ–±—ã—Ç–∏–π** –∏ **–º–∞—Å—à—Ç–∞–±**

## ‚úÖ –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å **RabbitMQ**:
- üìÆ **–ù—É–∂–Ω–∞ –±—ã—Å—Ç—Ä–∞—è –∏ –Ω–∞–¥—ë–∂–Ω–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞ –∑–∞–¥–∞—á –º–µ–∂–¥—É –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–∞–º–∏**
- üßæ **–ö–∞–∂–¥–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –Ω—É–∂–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å –æ–¥–∏–Ω —Ä–∞–∑ –∏ –∑–∞–±—ã—Ç—å**
- ‚è± **–•–æ—á–µ—à—å –≥–∏–±–∫–æ –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä–æ–≤–∞—Ç—å –º–∞—Ä—à—Ä—É—Ç—ã —Å–æ–æ–±—â–µ–Ω–∏–π** (`direct`, `fanout`, `topic`)
- üí• **–í–∞–∂–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å —Å–æ–±—ã—Ç–∏—è –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ** (push-–º–æ–¥–µ–ª—å)
- üì¶ **–ù—É–∂–Ω–∞ DLQ –∏ –ø–æ–≤—Ç–æ—Ä–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏** —Å –∫–æ–Ω—Ç—Ä–æ–ª–µ–º –≤—Ä–µ–º–µ–Ω–∏

üìå RabbitMQ = –æ—á–µ—Ä–µ–¥—å –∑–∞–¥–∞—á (task queue), –æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –Ω–∞ **—Å–æ–±—ã—Ç–∏–π–Ω—É—é –æ–±—Ä–∞–±–æ—Ç–∫—É**

## üîÑ –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É—é—Ç Kafka + RabbitMQ –≤–º–µ—Å—Ç–µ
### üéØ –°—Ü–µ–Ω–∞—Ä–∏–π: —É —Ç–µ–±—è –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞
1. **Kafka** –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è:
    - –°–±–æ—Ä —Å–æ–±—ã—Ç–∏–π –∏–∑ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤ (`user.created`, `order.placed`, `payment.failed`)
    - –•—Ä–∞–Ω–µ–Ω–∏–µ —ç—Ç–∏—Ö —Å–æ–±—ã—Ç–∏–π –∫–∞–∫ –ª–æ–≥–æ–≤
    - –ü–µ—Ä–µ–¥–∞—á–∞ –¥–∞–Ω–Ω—ã—Ö –≤ —Å–∏—Å—Ç–µ–º—ã –∞–Ω–∞–ª–∏—Ç–∏–∫–∏, –æ—Ç—á—ë—Ç–Ω–æ—Å—Ç–∏ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è

2. **RabbitMQ** –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è:
    - –†–µ–∞–ª—å–Ω–æ–≥–æ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–¥–∞—á: –æ—Ç–ø—Ä–∞–≤–∫–∞ email, –≥–µ–Ω–µ—Ä–∞—Ü–∏—è PDF, –¥–µ–±–µ—Ç —Å –∫–∞—Ä—Ç—ã
    - –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è, –±—ã—Å—Ç—Ä–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞ –≤ –æ—á–µ—Ä–µ–¥—å –∑–∞–¥–∞—á
    - –ü–æ–≤—Ç–æ—Ä—ã, DLQ, –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è –∏ –∫–æ–Ω—Ç—Ä–æ–ª—å –¥–æ—Å—Ç–∞–≤–∫–∏

- **–°–æ–±—ã—Ç–∏—è** –≤ Kafka:
    - –ù–µ–ª—å–∑—è —Ç–µ—Ä—è—Ç—å
    - –ù–µ–ª—å–∑—è –ø–µ—Ä–µ–ø—É—Ç–∞—Ç—å –ø–æ—Ä—è–¥–æ–∫ (`user.created` ‚Üí `user.verified`)
    - –ù—É–∂–Ω–æ —É–º–µ—Ç—å "–ø–µ—Ä–µ–º–æ—Ç–∞—Ç—å –Ω–∞–∑–∞–¥" (replay)

- **–ó–∞–¥–∞—á–∏** –≤ RabbitMQ:
    - –ú–æ–∂–Ω–æ –≤—ã–ø–æ–ª–Ω—è—Ç—å –≤ –ª—é–±–æ–º –ø–æ—Ä—è–¥–∫–µ
    - –ú–æ–∂–Ω–æ –ø–æ–≤—Ç–æ—Ä—è—Ç—å (—á–µ—Ä–µ–∑ DLQ)
    - –ì–ª–∞–≤–Ω–æ–µ ‚Äî —á—Ç–æ–±—ã –∫—Ç–æ-—Ç–æ —ç—Ç–æ **–≤—ã–ø–æ–ª–Ω–∏–ª**
